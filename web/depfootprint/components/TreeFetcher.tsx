import { useQuery } from 'react-query';

interface TreeFetcherProps {
    pkg: string
    children: (arg0: any) => any
}

const dependencies = { "name": "express", "version": "4.17.2", "healthScore": 95, "size": 209594, "children": [{ "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "escape-html", "version": "1.0.3", "healthScore": 71, "size": 0, "children": [] }, { "name": "utils-merge", "version": "1.0.1", "healthScore": 73, "size": 0, "children": [] }, { "name": "content-type", "version": "1.0.4", "healthScore": 67, "size": 0, "children": [] }, { "name": "cookie", "version": "0.4.2", "healthScore": 77, "size": 19721, "children": [] }, { "name": "cookie-signature", "version": "1.1.0", "healthScore": 71, "size": 0, "children": [] }, { "name": "debug", "version": "4.3.3", "healthScore": 94, "size": 42039, "children": [{ "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }, { "name": "range-parser", "version": "1.2.1", "healthScore": 74, "size": 8457, "children": [] }, { "name": "vary", "version": "1.1.2", "healthScore": 67, "size": 0, "children": [] }, { "name": "type-is", "version": "1.6.18", "healthScore": 74, "size": 18497, "children": [{ "name": "media-typer", "version": "1.1.0", "healthScore": 65, "size": 9256, "children": [] }, { "name": "mime-types", "version": "2.1.34", "healthScore": 78, "size": 18023, "children": [{ "name": "mime-db", "version": "1.51.0", "healthScore": 82, "size": 204019, "children": [] }] }] }, { "name": "content-disposition", "version": "0.5.4", "healthScore": 77, "size": 19113, "children": [{ "name": "safe-buffer", "version": "5.2.1", "healthScore": 71, "size": 32101, "children": [] }] }, { "name": "array-flatten", "version": "3.0.0", "healthScore": 69, "size": 20089, "children": [] }, { "name": "path-to-regexp", "version": "6.2.0", "healthScore": 84, "size": 111238, "children": [] }, { "name": "finalhandler", "version": "1.1.2", "healthScore": 67, "size": 17043, "children": [{ "name": "escape-html", "version": "1.0.3", "healthScore": 71, "size": 0, "children": [] }, { "name": "encodeurl", "version": "1.0.2", "healthScore": 65, "size": 0, "children": [] }, { "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "parseurl", "version": "1.3.3", "healthScore": 73, "size": 10299, "children": [] }, { "name": "unpipe", "version": "1.0.0", "healthScore": 65, "size": 0, "children": [] }, { "name": "on-finished", "version": "2.3.0", "healthScore": 71, "size": 0, "children": [{ "name": "ee-first", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }, { "name": "debug", "version": "4.3.3", "healthScore": 94, "size": 42039, "children": [{ "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }] }] }, { "name": "setprototypeof", "version": "1.2.0", "healthScore": 65, "size": 4025, "children": [] }, { "name": "etag", "version": "1.8.1", "healthScore": 67, "size": 0, "children": [] }, { "name": "fresh", "version": "0.5.2", "healthScore": 70, "size": 0, "children": [] }, { "name": "merge-descriptors", "version": "1.0.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "parseurl", "version": "1.3.3", "healthScore": 73, "size": 10299, "children": [] }, { "name": "encodeurl", "version": "1.0.2", "healthScore": 65, "size": 0, "children": [] }, { "name": "proxy-addr", "version": "2.0.7", "healthScore": 71, "size": 15399, "children": [{ "name": "forwarded", "version": "0.2.0", "healthScore": 68, "size": 5876, "children": [] }, { "name": "ipaddr.js", "version": "2.0.1", "healthScore": 76, "size": 59520, "children": [] }] }, { "name": "methods", "version": "1.1.2", "healthScore": 71, "size": 0, "children": [] }, { "name": "qs", "version": "6.10.3", "healthScore": 91, "size": 216400, "children": [{ "name": "side-channel", "version": "1.0.4", "healthScore": 67, "size": 14565, "children": [{ "name": "object-inspect", "version": "1.12.0", "healthScore": 81, "size": 90592, "children": [] }, { "name": "get-intrinsic", "version": "1.1.1", "healthScore": 70, "size": 32513, "children": [{ "name": "has-symbols", "version": "1.0.2", "healthScore": 71, "size": 18056, "children": [] }, { "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "has", "version": "1.0.3", "healthScore": 67, "size": 2770, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }] }, { "name": "call-bind", "version": "1.0.2", "healthScore": 67, "size": 14748, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "get-intrinsic", "version": "1.1.1", "healthScore": 70, "size": 32513, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "has-symbols", "version": "1.0.2", "healthScore": 71, "size": 18056, "children": [] }, { "name": "has", "version": "1.0.3", "healthScore": 67, "size": 2770, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }] }] }] }] }, { "name": "safe-buffer", "version": "5.2.1", "healthScore": 71, "size": 32101, "children": [] }, { "name": "send", "version": "0.17.2", "healthScore": 85, "size": 48373, "children": [{ "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }, { "name": "range-parser", "version": "1.2.1", "healthScore": 74, "size": 8457, "children": [] }, { "name": "destroy", "version": "1.1.0", "healthScore": 78, "size": 7604, "children": [] }, { "name": "fresh", "version": "0.5.2", "healthScore": 70, "size": 0, "children": [] }, { "name": "etag", "version": "1.8.1", "healthScore": 67, "size": 0, "children": [] }, { "name": "mime", "version": "3.0.0", "healthScore": 80, "size": 60080, "children": [] }, { "name": "on-finished", "version": "2.3.0", "healthScore": 71, "size": 0, "children": [{ "name": "ee-first", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }, { "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }, { "name": "encodeurl", "version": "1.0.2", "healthScore": 65, "size": 0, "children": [] }, { "name": "escape-html", "version": "1.0.3", "healthScore": 71, "size": 0, "children": [] }, { "name": "http-errors", "version": "2.0.0", "healthScore": 86, "size": 18808, "children": [{ "name": "inherits", "version": "2.0.4", "healthScore": 73, "size": 3958, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }, { "name": "setprototypeof", "version": "1.2.0", "healthScore": 65, "size": 4025, "children": [] }, { "name": "toidentifier", "version": "1.0.1", "healthScore": 75, "size": 4685, "children": [] }, { "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }] }, { "name": "debug", "version": "4.3.3", "healthScore": 94, "size": 42039, "children": [{ "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }] }] }, { "name": "on-finished", "version": "2.3.0", "healthScore": 71, "size": 0, "children": [{ "name": "ee-first", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }, { "name": "accepts", "version": "1.3.8", "healthScore": 77, "size": 16795, "children": [{ "name": "negotiator", "version": "0.6.3", "healthScore": 89, "size": 27375, "children": [] }, { "name": "mime-types", "version": "2.1.34", "healthScore": 78, "size": 18023, "children": [{ "name": "mime-db", "version": "1.51.0", "healthScore": 82, "size": 204019, "children": [] }] }] }, { "name": "body-parser", "version": "1.19.2", "healthScore": 83, "size": 57391, "children": [{ "name": "bytes", "version": "3.1.2", "healthScore": 85, "size": 12270, "children": [] }, { "name": "content-type", "version": "1.0.4", "healthScore": 67, "size": 0, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }, { "name": "debug", "version": "4.3.3", "healthScore": 94, "size": 42039, "children": [{ "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }] }, { "name": "iconv-lite", "version": "0.6.3", "healthScore": 78, "size": 348518, "children": [{ "name": "safer-buffer", "version": "2.1.2", "healthScore": 65, "size": 42299, "children": [] }] }, { "name": "http-errors", "version": "2.0.0", "healthScore": 86, "size": 18808, "children": [{ "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "toidentifier", "version": "1.0.1", "healthScore": 75, "size": 4685, "children": [] }, { "name": "setprototypeof", "version": "1.2.0", "healthScore": 65, "size": 4025, "children": [] }, { "name": "inherits", "version": "2.0.4", "healthScore": 73, "size": 3958, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }] }, { "name": "type-is", "version": "1.6.18", "healthScore": 74, "size": 18497, "children": [{ "name": "media-typer", "version": "1.1.0", "healthScore": 65, "size": 9256, "children": [] }, { "name": "mime-types", "version": "2.1.34", "healthScore": 78, "size": 18023, "children": [{ "name": "mime-db", "version": "1.51.0", "healthScore": 82, "size": 204019, "children": [] }] }] }, { "name": "on-finished", "version": "2.3.0", "healthScore": 71, "size": 0, "children": [{ "name": "ee-first", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }, { "name": "raw-body", "version": "2.4.3", "healthScore": 78, "size": 22938, "children": [{ "name": "unpipe", "version": "1.0.0", "healthScore": 65, "size": 0, "children": [] }, { "name": "bytes", "version": "3.1.2", "healthScore": 85, "size": 12270, "children": [] }, { "name": "iconv-lite", "version": "0.6.3", "healthScore": 78, "size": 348518, "children": [{ "name": "safer-buffer", "version": "2.1.2", "healthScore": 65, "size": 42299, "children": [] }] }, { "name": "http-errors", "version": "2.0.0", "healthScore": 86, "size": 18808, "children": [{ "name": "setprototypeof", "version": "1.2.0", "healthScore": 65, "size": 4025, "children": [] }, { "name": "inherits", "version": "2.0.4", "healthScore": 73, "size": 3958, "children": [] }, { "name": "toidentifier", "version": "1.0.1", "healthScore": 75, "size": 4685, "children": [] }, { "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }] }] }, { "name": "qs", "version": "6.10.3", "healthScore": 91, "size": 216400, "children": [{ "name": "side-channel", "version": "1.0.4", "healthScore": 67, "size": 14565, "children": [{ "name": "object-inspect", "version": "1.12.0", "healthScore": 81, "size": 90592, "children": [] }, { "name": "get-intrinsic", "version": "1.1.1", "healthScore": 70, "size": 32513, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "has-symbols", "version": "1.0.2", "healthScore": 71, "size": 18056, "children": [] }, { "name": "has", "version": "1.0.3", "healthScore": 67, "size": 2770, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }] }, { "name": "call-bind", "version": "1.0.2", "healthScore": 67, "size": 14748, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "get-intrinsic", "version": "1.1.1", "healthScore": 70, "size": 32513, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }, { "name": "has-symbols", "version": "1.0.2", "healthScore": 71, "size": 18056, "children": [] }, { "name": "has", "version": "1.0.3", "healthScore": 67, "size": 2770, "children": [{ "name": "function-bind", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }] }] }] }] }] }, { "name": "serve-static", "version": "1.14.2", "healthScore": 83, "size": 24950, "children": [{ "name": "encodeurl", "version": "1.0.2", "healthScore": 65, "size": 0, "children": [] }, { "name": "parseurl", "version": "1.3.3", "healthScore": 73, "size": 10299, "children": [] }, { "name": "escape-html", "version": "1.0.3", "healthScore": 71, "size": 0, "children": [] }, { "name": "send", "version": "0.17.2", "healthScore": 85, "size": 48373, "children": [{ "name": "destroy", "version": "1.1.0", "healthScore": 78, "size": 7604, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }, { "name": "encodeurl", "version": "1.0.2", "healthScore": 65, "size": 0, "children": [] }, { "name": "range-parser", "version": "1.2.1", "healthScore": 74, "size": 8457, "children": [] }, { "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "mime", "version": "3.0.0", "healthScore": 80, "size": 60080, "children": [] }, { "name": "escape-html", "version": "1.0.3", "healthScore": 71, "size": 0, "children": [] }, { "name": "etag", "version": "1.8.1", "healthScore": 67, "size": 0, "children": [] }, { "name": "on-finished", "version": "2.3.0", "healthScore": 71, "size": 0, "children": [{ "name": "ee-first", "version": "1.1.1", "healthScore": 71, "size": 0, "children": [] }] }, { "name": "debug", "version": "4.3.3", "healthScore": 94, "size": 42039, "children": [{ "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }] }, { "name": "fresh", "version": "0.5.2", "healthScore": 70, "size": 0, "children": [] }, { "name": "ms", "version": "2.1.3", "healthScore": 84, "size": 6721, "children": [] }, { "name": "http-errors", "version": "2.0.0", "healthScore": 86, "size": 18808, "children": [{ "name": "toidentifier", "version": "1.0.1", "healthScore": 75, "size": 4685, "children": [] }, { "name": "setprototypeof", "version": "1.2.0", "healthScore": 65, "size": 4025, "children": [] }, { "name": "depd", "version": "2.0.0", "healthScore": 70, "size": 27117, "children": [] }, { "name": "statuses", "version": "2.0.1", "healthScore": 71, "size": 12116, "children": [] }, { "name": "inherits", "version": "2.0.4", "healthScore": 73, "size": 3958, "children": [] }] }] }] }] }

export default function TreeFetcher({ pkg, children }: TreeFetcherProps) {
    const query = useQuery('tree', async () => {
        const response = await fetch(`/api/tree/${pkg}`);

        if (!response.ok) {
            throw new Error(`HTTP error: ${response.status}`);
        }

        const json = await response.json();

        return json;

    }, { refetchOnWindowFocus: false });

    if (query.isLoading) {
        return <div>Loading...</div>
    }

    if (query.isError) {
        return <div>Oops :(</div>
    }

    return children({ dependencies: query.data })
}